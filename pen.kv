ScreenManager:
    AuthScreen:
        name: 'auth'
    MainScreen:
        name: "main"
    ProfileScreen:
        name: "profile"
    ChallengesScreen:
        name: "challenges"
    ExercisesScreen:
        name: "exercises"
    ArticlesScreen:
        name: "articles"
    ArticleDetailScreen:
        name: "article_detail"
    ArticleFormScreen:
        name: "article_form"
    ShopScreen:
        name: "shop"
    ProfileViewScreen:
        name: "profile_view"


<AuthScreen>:
    BoxLayout:
        orientation: 'vertical'
        padding: 20
        spacing: 10

        Label:
            text: 'Вход / Регистрация'
            font_size: 24

        TextInput:
            id: email_input
            hint_text: 'Введите email'
            size_hint_y: None
            height: 40

        TextInput:
            id: password_input
            hint_text: 'Введите пароль'
            password: True
            size_hint_y: None
            height: 40

        Label:
            id: error_label
            color: 1, 0, 0, 1
            size_hint_y: None
            height: self.texture_size[1]

        BoxLayout:
            size_hint_y: None
            height: 50
            spacing: 10

            Button:
                text: 'Войти'
                on_press: root.login_user()

            Button:
                text: 'Зарегистрироваться'
                on_press: root.register_user()

<MainScreen>:
    BoxLayout:
        orientation: "vertical"
        spacing: 10
        padding: 20

        Button:
            id: profile_button
            text: "Личный кабинет"
            background_color: 1, 1, 1, 1
            on_press: app.root.current = "profile"

        Button:
            id: challenges_button
            text: "Челленджи"
            background_color: 1, 1, 1, 1
            on_press: app.root.current = "challenges"

        Button:
            id: exercises_button
            text: "Упражнения"
            background_color: 1, 1, 1, 1
            on_press: app.root.current = "exercises"

        Button:
            id: articles_button
            text: "Статьи"
            background_color: 1, 1, 1, 1
            on_press: app.root.current = "articles"

        Button:
            id: goal_button
            text: "Цель не выполнена"
            background_color: 1, 1, 1, 1
            on_press: root.toggle_goal()

        Button:
            text: "Посмотреть профиль"
            background_color: 1, 1, 1, 1
            on_press: app.root.current = "profile_view"

        Button:
            text: "Выйти из аккаунта"
            background_color: 1, 0.5, 0.5, 1
            on_press: root.logout()

        Label:
            text: "Активный челлендж:"
        Label:
            id: current_challenge_label
            text: ""

        Button:
            id: complete_challenge_button
            text: "Выполнить челлендж"
            size_hint_y: None
            height: 40
            on_press: root.complete_challenge()

        Button:
            id: cancel_challenge_button
            text: "Отменить челлендж"
            size_hint_y: None
            height: 40
            on_press: root.cancel_challenge()

        Button:
            text: "Выход"
            background_color: 1, 0.5, 0.5, 1
            on_press: app.stop()

<ProfileScreen>:
    BoxLayout:
        orientation: "vertical"
        padding: 20
        spacing: 10

        Button:
            id: back_button
            text: "Назад"
            size_hint_y: None
            height: 40
            on_press: app.root.current = 'main'

        Label:
            text: "Имя:"
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: max(name_value.texture_size[1], 40)
            spacing: 8
            Label:
                id: name_value
                text: ''
                size_hint_y: None
                height: self.texture_size[1]
                size_hint_x: None
                width: self.texture_size[0]
            Button:
                size_hint_x: None
                width: 120
                text: 'Изменить'
                on_press: app.root.get_screen('profile').prompt_edit('name')

        Label:
            text: "Любимый жанр:"
        Spinner:
            id: favorite_genre_spinner
            text: "Выберите жанр"
            values: ['Фантастика', 'Романтика', 'Драма', 'Комедия']

        Label:
            text: "Цель (слова на день):"
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: max(goal_value.texture_size[1], 40)
            spacing: 8
            Label:
                id: goal_value
                text: ''
                size_hint_y: None
                height: self.texture_size[1]
                size_hint_x: None
                width: self.texture_size[0]
            Button:
                size_hint_x: None
                width: 120
                text: 'Изменить'
                on_press: app.root.get_screen('profile').prompt_edit('goal')

        Label:
            id: points_label
            text: "Баллы: 0"

        BoxLayout:
            size_hint_y: None
            height: 50
            spacing: 10

            Button:
                id: shop_button
                text: 'Магазин улучшений'
                on_press: app.root.current = 'shop'

            Button:
                id: save_button
                text: 'Сохранить'
                on_press:
                    app.root.get_screen('profile').save_user_data() if hasattr(app.root.get_screen('profile'), 'save_user_data') else None

        Button:
            id: logout_button
            text: 'Выйти из аккаунта'
            size_hint_y: None
            height: 40
            background_color: 1, 0.5, 0.5, 1
            on_press: app.root.get_screen('profile').logout()

<ChallengesScreen>:
    BoxLayout:
        orientation: "vertical"
        Button:
            size_hint: 0.3, None
            height: 40
            text: "Назад"
            on_press: app.root.current = "main"
        Label:
            text: "Челленджи"
        BoxLayout:
            orientation: 'vertical'
            spacing: 8
            padding: 10
            Button:
                id: challenge1_button
                text: "Написать 10000 слов"
                on_press: root.start_challenge(1)
            Button:
                id: challenge2_button
                text: "Создать 5 сцен"
                on_press: root.start_challenge(2)
            Button:
                id: challenge3_button
                text: "Придумать 10 персонажей"
                on_press: root.start_challenge(3)
            Button:
                id: challenge4_button
                text: "Проработать 30 сцен"
                on_press: root.start_challenge(4)
            Button:
                id: challenge5_button
                text: "Дописать книгу"
                on_press: root.start_challenge(5)

<ExercisesScreen>:
    BoxLayout:
        orientation: "vertical"
        padding: 10
        spacing: 10

        Button:
            size_hint: 0.3, None
            height: 40
            text: "Назад"
            on_press: app.root.current = "main"

        Label:
            text: "Упражнения"

        BoxLayout:
            orientation: 'vertical'
            spacing: 8

            Button:
                id: three_btn
                text: 'Три в ряд'
                on_press: root.on_exercise_selected('three_in_row')

            Button:
                id: poetic_btn
                text: 'Поэтический след'
                on_press: root.on_exercise_selected('poetic_trace')

            Button:
                id: why_btn
                text: 'Почему?'
                on_press: root.on_exercise_selected('why')

            Label:
                id: exercise_prompt
                text: ''
                size_hint_y: None
                height: self.texture_size[1]

            TextInput:
                id: exercise_input
                hint_text: 'Ваш ответ...'
                multiline: False
                size_hint_y: None
                height: 40
                on_text_validate: root.on_exercise_submitted()

<ArticlesScreen>:
    BoxLayout:
        orientation: "vertical"
        spacing: 10
        padding: 10

        Button:
            size_hint: 0.3, None
            height: 40
            text: "Назад"
            on_press: app.root.current = "main"

        Button:
            id: add_article_button
            size_hint_y: None
            height: 40
            text: 'Добавить статью'
            on_press: root.open_article_form()

        ScrollView:
            do_scroll_x: False

            BoxLayout:
                id: articles_container
                orientation: "vertical"
                size_hint_y: None
                height: self.minimum_height

<ArticleDetailScreen>:
    BoxLayout:
        orientation: "vertical"
        padding: 20
        spacing: 10

        Button:
            size_hint: 0.3, None
            height: 40
            text: "Назад к статьям"
            on_press: app.root.current = "articles"

        ScrollView:
            Label:
                text: root.article_text
                size_hint_y: None
                height: self.texture_size[1]
                text_size: self.width, None

<ArticleFormScreen>:
    BoxLayout:
        orientation: 'vertical'
        padding: 10
        spacing: 8
        Button:
            size_hint_y: None
            height: 40
            text: 'Назад к статьям'
            on_press: app.root.current = 'articles'
        TextInput:
            id: new_article_title
            hint_text: 'Заголовок'
            size_hint_y: None
            height: 40
        TextInput:
            id: new_article_text
            hint_text: 'Текст статьи'
            size_hint_y: None
            height: 140
        Button:
            size_hint_y: None
            height: 40
            text: 'Опубликовать'
            on_press: root.submit_article()

<ShopScreen>:
    BoxLayout:
        orientation: "vertical"
        padding: 10
        spacing: 8

        Button:
            size_hint_y: None
            height: 40
            text: 'Назад'
            on_press: app.root.current = 'profile'

        Button:
            text: "1 (50 баллов)"
            on_press: root.buy_item(1, 50)

        Button:
            text: "2 (100 баллов)"
            on_press: root.buy_item(2, 100)

        Button:
            text: "3 (150 баллов)"
            on_press: root.buy_item(3, 150)

        Button:
            text: "4 (200 баллов)"
            on_press: root.buy_item(4, 200)

        Button:
            text: "5 (250 баллов)"
            on_press: root.buy_item(5, 250)

        Button:
            text: "Случайное улучшение (100 баллов)"
            on_press: root.buy_random_upgrade()

<ProfileViewScreen>:
    BoxLayout:
        orientation: "vertical"
        padding: 20
        spacing: 10

        Button:
            text: "Назад"
            size_hint_y: None
            height: 40
            on_press: app.root.current = 'main'

        Label:
            text: "Поиск профиля пользователя"
            font_size: 15

        TextInput:
            id: email_input
            hint_text: 'Введите email пользователя'
            size_hint_y: None
            height: 40

        Button:
            text: "Найти профиль"
            size_hint_y: None
            height: 40
            on_press: root.find_profile()

        Label:
            id: error_label
            color: 1, 0, 0, 1
            size_hint_y: None
            height: self.texture_size[1]

        ScrollView:
            BoxLayout:
                id: profile_container
                orientation: "vertical"
                size_hint_y: None
                height: self.minimum_height
                spacing: 10
